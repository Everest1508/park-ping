<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vehicle Contact - ParkPing</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .card-shadow { box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
    .hover-lift { transition: all 0.2s ease-in-out; }
    .hover-lift:hover { transform: translateY(-2px); box-shadow: 0 8px 12px rgba(0, 0, 0, 0.15); }
  </style>
</head>
<body class="h-full bg-green-50">
  <div class="min-h-full flex flex-col">
    <!-- Main Content -->
    <main class="flex-1 py-8">
      <div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Contact Card -->
        <div class="bg-white rounded-2xl card-shadow overflow-hidden">
          <!-- Card Header -->
          <div class="bg-green-500 px-6 py-8 text-center">
            <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center mx-auto mb-4">
              <i data-lucide="car" class="w-8 h-8 text-green-500"></i>
            </div>
            <h2 class="text-2xl font-bold text-white mb-2">Vehicle Contact Information</h2>
            <p class="text-green-100">The vehicle owner has shared the following information with you</p>
          </div>

          <!-- Contact Information -->
          <div class="p-6 bg-white">
            {% if contact_info %}
              <div class="space-y-6">
                <!-- Vehicle Details -->
                {% if contact_info.vehicle %}
                  <div class="border-b border-gray-200 pb-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                      <div class="w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center mr-3">
                        <i data-lucide="car" class="w-4 h-4 text-white"></i>
                      </div>
                      Vehicle Details
                    </h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                      <div class="bg-green-50 rounded-xl p-4 border border-green-100 hover-lift">
                        <div class="flex items-center mb-2">
                          <div class="w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center mr-3">
                            <i data-lucide="car" class="w-4 h-4 text-white"></i>
                          </div>
                          <p class="text-sm font-medium text-green-600">Make & Model</p>
                        </div>
                        <p class="text-lg font-semibold text-gray-900">{{ contact_info.vehicle.year }} {{ contact_info.vehicle.make }} {{ contact_info.vehicle.model }}</p>
                      </div>
                      <div class="bg-green-50 rounded-xl p-4 border border-green-100 hover-lift">
                        <div class="flex items-center mb-2">
                          <div class="w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center mr-3">
                            <i data-lucide="hash" class="w-4 h-4 text-white"></i>
                          </div>
                          <p class="text-sm font-medium text-green-600">License Plate</p>
                        </div>
                        <p class="text-lg font-semibold text-gray-900">{{ contact_info.vehicle.license_plate }}</p>
                      </div>
                      <div class="bg-green-50 rounded-xl p-4 border border-green-100 hover-lift sm:col-span-2">
                        <div class="flex items-center mb-2">
                          <div class="w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center mr-3">
                            <i data-lucide="palette" class="w-4 h-4 text-white"></i>
                          </div>
                          <p class="text-sm font-medium text-green-600">Color</p>
                        </div>
                        <p class="text-lg font-semibold text-gray-900">{{ contact_info.vehicle.color }}</p>
                      </div>
                    </div>
                  </div>
                {% endif %}

                <!-- Contact Methods -->
                <div>
                  <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                    <div class="w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center mr-3">
                      <i data-lucide="contact" class="w-4 h-4 text-white"></i>
                    </div>
                    Contact Information
                  </h3>
                  
                  <div class="space-y-4">
                    {% if contact_info.name %}
                      <div class="flex items-center p-4 bg-green-50 rounded-lg border border-green-100 hover-lift">
                        <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center mr-4">
                          <i data-lucide="user" class="w-5 h-5 text-white"></i>
                        </div>
                        <div class="flex-1">
                          <p class="text-sm text-green-600 font-medium">Owner Name</p>
                          <p class="text-lg text-gray-900 font-semibold">{{ contact_info.name }}</p>
                        </div>
                      </div>
                    {% endif %}

                    {% if contact_info.masking_enabled %}
                      <!-- Masking enabled - hide phone number -->
                      <div class="flex items-center p-4 bg-green-50 rounded-lg border border-green-100 hover-lift">
                        <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center mr-4">
                          <i data-lucide="shield" class="w-5 h-5 text-white"></i>
                        </div>
                        <div class="flex-1">
                          <p class="text-sm text-green-600 font-medium">Contact Number</p>
                          <p class="text-lg text-gray-900 font-semibold mb-2" id="phone-display">Click to reveal number</p>
                          <div id="masking-info" class="text-xs text-green-600">
                            <i data-lucide="shield" class="w-3 h-3 inline mr-1"></i>
                            <span id="masking-status">Number masking enabled</span>
                            <span id="expiry-info" class="ml-2"></span>
                          </div>
                        </div>
                        <button id="call-button" class="ml-4 inline-flex items-center px-4 py-2 bg-green-500 text-white text-sm font-medium rounded-lg hover:bg-green-600 shadow-sm hover:shadow-md transition-all" onclick="handleCallClick()">
                          <i data-lucide="phone-call" class="w-4 h-4 mr-2"></i>
                          <span id="call-button-text">Call Now</span>
                        </button>
                      </div>
                    {% elif contact_info.phone %}
                      <!-- Regular phone display -->
                      <div class="flex items-center p-4 bg-green-50 rounded-lg border border-green-100 hover-lift">
                        <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center mr-4">
                          <i data-lucide="phone" class="w-5 h-5 text-white"></i>
                        </div>
                        <div class="flex-1">
                          <p class="text-sm text-green-600 font-medium">Phone Number</p>
                          <p class="text-lg text-gray-900 font-semibold">{{ contact_info.phone }}</p>
                        </div>
                        <a href="tel:{{ contact_info.phone }}" class="ml-4 inline-flex items-center px-4 py-2 bg-green-500 text-white text-sm font-medium rounded-lg hover:bg-green-600 shadow-sm hover:shadow-md transition-all">
                          <i data-lucide="phone-call" class="w-4 h-4 mr-2"></i>
                          Call Now
                        </a>
                      </div>
                    {% endif %}

                    {% if contact_info.email %}
                      <div class="flex items-center p-4 bg-green-50 rounded-lg border border-green-100 hover-lift">
                        <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center mr-4">
                          <i data-lucide="mail" class="w-5 h-5 text-white"></i>
                        </div>
                        <div class="flex-1">
                          <p class="text-sm text-green-600 font-medium">Email Address</p>
                          <p class="text-lg text-gray-900 font-semibold">{{ contact_info.email }}</p>
                        </div>
                        <a href="mailto:{{ contact_info.email }}" class="ml-4 inline-flex items-center px-4 py-2 bg-green-500 text-white text-sm font-medium rounded-lg hover:bg-green-600 shadow-sm hover:shadow-md transition-all">
                          <i data-lucide="send" class="w-4 h-4 mr-2"></i>
                          Send Email
                        </a>
                      </div>
                    {% endif %}

                    {% if contact_info.emergency_contact %}
                      <div class="flex items-center p-4 bg-green-50 rounded-lg border border-green-100 hover-lift">
                        <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center mr-4">
                          <i data-lucide="alert-circle" class="w-5 h-5 text-white"></i>
                        </div>
                        <div class="flex-1">
                          <p class="text-sm text-green-600 font-medium">Emergency Contact</p>
                          <p class="text-lg text-gray-900 font-semibold">{{ contact_info.emergency_contact }}</p>
                        </div>
                        <a href="tel:{{ contact_info.emergency_contact }}" class="ml-4 inline-flex items-center px-4 py-2 bg-green-500 text-white text-sm font-medium rounded-lg hover:bg-green-600 shadow-sm hover:shadow-md transition-all">
                          <i data-lucide="phone-call" class="w-4 h-4 mr-2"></i>
                          Call Emergency
                        </a>
                      </div>
                    {% endif %}

                    {% if contact_info.helpline %}
                      <div class="flex items-center p-4 bg-green-50 rounded-lg border border-green-100 hover-lift">
                        <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center mr-4">
                          <i data-lucide="phone" class="w-5 h-5 text-white"></i>
                        </div>
                        <div class="flex-1">
                          <p class="text-sm text-green-600 font-medium">
                            {% if contact_info.helpline_is_default %}
                              ParkPing Helpline
                            {% else %}
                              Helpline Number
                            {% endif %}
                          </p>
                          <p class="text-lg text-gray-900 font-semibold">{{ contact_info.helpline }}</p>
                        </div>
                        <a href="tel:{{ contact_info.helpline }}" class="ml-4 inline-flex items-center px-4 py-2 bg-green-500 text-white text-sm font-medium rounded-lg hover:bg-green-600 shadow-sm hover:shadow-md transition-all">
                          <i data-lucide="phone-call" class="w-4 h-4 mr-2"></i>
                          Call Helpline
                        </a>
                      </div>
                    {% endif %}
                  </div>
                </div>

                <!-- Additional Actions -->
                {% if contact_info.masking_enabled or contact_info.phone %}
                  <div class="border-t border-gray-200 pt-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                      <div class="w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center mr-3">
                        <i data-lucide="message-circle" class="w-4 h-4 text-white"></i>
                      </div>
                      Quick Actions
                    </h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                      {% if contact_info.masking_enabled %}
                        <button id="quick-call-button" onclick="handleCallClick()" class="flex items-center justify-center px-6 py-4 bg-green-500 text-white text-sm font-medium rounded-xl hover:bg-green-600 shadow-sm hover:shadow-md transition-all">
                          <i data-lucide="phone" class="w-5 h-5 mr-2"></i>
                          <span id="quick-call-text">Call Owner</span>
                        </button>
                      {% else %}
                        <a href="tel:{{ contact_info.phone }}" class="flex items-center justify-center px-6 py-4 bg-green-500 text-white text-sm font-medium rounded-xl hover:bg-green-600 shadow-sm hover:shadow-md transition-all">
                          <i data-lucide="phone" class="w-5 h-5 mr-2"></i>
                          Call Owner
                        </a>
                      {% endif %}
                      {% if contact_info.phone %}
                        <a href="sms:{{ contact_info.phone }}" class="flex items-center justify-center px-6 py-4 bg-green-500 text-white text-sm font-medium rounded-xl hover:bg-green-600 shadow-sm hover:shadow-md transition-all">
                          <i data-lucide="message-square" class="w-5 h-5 mr-2"></i>
                          Send SMS
                        </a>
                      {% endif %}
                    </div>
                  </div>
                {% endif %}
              </div>
            {% else %}
              <!-- No Contact Info Available -->
              <div class="text-center py-12">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                  <i data-lucide="shield-x" class="w-8 h-8 text-green-500"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">No Contact Information Available</h3>
                <p class="text-gray-600">The vehicle owner has not shared any contact information publicly.</p>
              </div>
            {% endif %}
          </div>
        </div>

        <!-- Emergency Numbers Section -->
        <div class="mt-8">
          <div class="bg-white rounded-2xl card-shadow overflow-hidden">
            <div class="bg-green-500 px-6 py-6 text-center">
              <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center mx-auto mb-3">
                <i data-lucide="alert-triangle" class="w-8 h-8 text-green-500"></i>
              </div>
              <h3 class="text-2xl font-bold text-white mb-2">Emergency Services</h3>
              <p class="text-green-100">Important numbers for emergencies</p>
            </div>
            <div class="p-6">
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <!-- Police -->
                {% if emergency_numbers.police %}
                  <a href="tel:{{ emergency_numbers.police }}" class="flex items-center p-4 bg-green-50 rounded-xl border border-green-100 hover-lift">
                    <div class="w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center mr-4">
                      <i data-lucide="shield" class="w-6 h-6 text-white"></i>
                    </div>
                    <div class="flex-1">
                      <p class="text-xs text-green-600 font-medium mb-1">Police</p>
                      <p class="text-lg text-gray-900 font-semibold">{{ emergency_numbers.police }}</p>
                    </div>
                    <i data-lucide="phone-call" class="w-5 h-5 text-green-500"></i>
                  </a>
                {% endif %}

                <!-- Ambulance -->
                {% if emergency_numbers.ambulance %}
                  <a href="tel:{{ emergency_numbers.ambulance }}" class="flex items-center p-4 bg-green-50 rounded-xl border border-green-100 hover-lift">
                    <div class="w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center mr-4">
                      <i data-lucide="heart-pulse" class="w-6 h-6 text-white"></i>
                    </div>
                    <div class="flex-1">
                      <p class="text-xs text-green-600 font-medium mb-1">Ambulance</p>
                      <p class="text-lg text-gray-900 font-semibold">{{ emergency_numbers.ambulance }}</p>
                    </div>
                    <i data-lucide="phone-call" class="w-5 h-5 text-green-500"></i>
                  </a>
                {% endif %}

                <!-- Fire Department -->
                {% if emergency_numbers.fire %}
                  <a href="tel:{{ emergency_numbers.fire }}" class="flex items-center p-4 bg-green-50 rounded-xl border border-green-100 hover-lift">
                    <div class="w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center mr-4">
                      <i data-lucide="flame" class="w-6 h-6 text-white"></i>
                    </div>
                    <div class="flex-1">
                      <p class="text-xs text-green-600 font-medium mb-1">Fire Department</p>
                      <p class="text-lg text-gray-900 font-semibold">{{ emergency_numbers.fire }}</p>
                    </div>
                    <i data-lucide="phone-call" class="w-5 h-5 text-green-500"></i>
                  </a>
                {% endif %}

                <!-- Women Helpline -->
                {% if emergency_numbers.women_helpline %}
                  <a href="tel:{{ emergency_numbers.women_helpline }}" class="flex items-center p-4 bg-green-50 rounded-xl border border-green-100 hover-lift">
                    <div class="w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center mr-4">
                      <i data-lucide="heart" class="w-6 h-6 text-white"></i>
                    </div>
                    <div class="flex-1">
                      <p class="text-xs text-green-600 font-medium mb-1">Women Helpline</p>
                      <p class="text-lg text-gray-900 font-semibold">{{ emergency_numbers.women_helpline }}</p>
                    </div>
                    <i data-lucide="phone-call" class="w-5 h-5 text-green-500"></i>
                  </a>
                {% endif %}

                <!-- Child Helpline -->
                {% if emergency_numbers.child_helpline %}
                  <a href="tel:{{ emergency_numbers.child_helpline }}" class="flex items-center p-4 bg-green-50 rounded-xl border border-green-100 hover-lift">
                    <div class="w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center mr-4">
                      <i data-lucide="users" class="w-6 h-6 text-white"></i>
                    </div>
                    <div class="flex-1">
                      <p class="text-xs text-green-600 font-medium mb-1">Child Helpline</p>
                      <p class="text-lg text-gray-900 font-semibold">{{ emergency_numbers.child_helpline }}</p>
                    </div>
                    <i data-lucide="phone-call" class="w-5 h-5 text-green-500"></i>
                  </a>
                {% endif %}

                <!-- Roadside Assistance / Traffic Helpline -->
                {% if emergency_numbers.roadside_assistance %}
                  <a href="tel:{{ emergency_numbers.roadside_assistance }}" class="flex items-center p-4 bg-green-50 rounded-xl border border-green-100 hover-lift sm:col-span-2">
                    <div class="w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center mr-4">
                      <i data-lucide="wrench" class="w-6 h-6 text-white"></i>
                    </div>
                    <div class="flex-1">
                      <p class="text-xs text-green-600 font-medium mb-1">Traffic / Roadside Assistance</p>
                      <p class="text-lg text-gray-900 font-semibold">{{ emergency_numbers.roadside_assistance }}</p>
                    </div>
                    <i data-lucide="phone-call" class="w-5 h-5 text-green-500"></i>
                  </a>
                {% endif %}
              </div>
            </div>
          </div>
        </div>

        <!-- Footer Info -->
        <div class="mt-8 text-center">
          <div class="bg-green-500 rounded-2xl p-8 card-shadow">
            <div class="flex items-center justify-center mb-4">
              <div class="w-12 h-12 bg-white rounded-lg flex items-center justify-center mr-3">
                <i data-lucide="shield-check" class="w-6 h-6 text-green-500"></i>
              </div>
              <h3 class="text-2xl font-bold text-white">Powered by ParkPing</h3>
            </div>
            <p class="text-sm text-green-100 mb-4">
              This QR code was generated by ParkPing to help vehicle owners share contact information safely and conveniently.
            </p>
            <a href="/" class="inline-flex items-center text-sm text-white font-medium hover:text-green-100 transition-all">
              <i data-lucide="external-link" class="w-4 h-4 mr-1"></i>
              Learn more about ParkPing
            </a>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    // Global variables for masking functionality
    let currentMaskedNumber = null;
    let currentSessionId = null;
    let maskingExpiryTime = null;
    let maskingTimer = null;
    
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize Lucide icons
      lucide.createIcons();
      
      // Check for existing masking session on page load
      checkExistingMaskingSession();
    });
    
    async function handleCallClick() {
      const callButton = document.getElementById('call-button');
      const quickCallButton = document.getElementById('quick-call-button');
      const callButtonText = document.getElementById('call-button-text');
      const quickCallText = document.getElementById('quick-call-text');
      
      // Disable buttons during processing
      if (callButton) callButton.disabled = true;
      if (quickCallButton) quickCallButton.disabled = true;
      if (callButtonText) callButtonText.textContent = 'Getting masked number...';
      if (quickCallText) quickCallText.textContent = 'Getting masked number...';
      
      try {
        const response = await fetch(`/parking/qr/{{ vehicle.qr_unique_id }}/masked-number/`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
          },
          body: JSON.stringify({})
        });
        
        const data = await response.json();
        
        if (data.success) {
          // Update UI with masked number
          currentMaskedNumber = data.masked_number;
          currentSessionId = data.session_id;
          maskingExpiryTime = new Date(data.expires_at);
          
          // Update phone display
          const phoneDisplay = document.getElementById('phone-display');
          if (phoneDisplay) phoneDisplay.textContent = data.masked_number;
          
          // Show masking info
          const maskingInfo = document.getElementById('masking-info');
          if (maskingInfo) maskingInfo.classList.remove('hidden');
          
          // Update masking status
          const maskingStatus = document.getElementById('masking-status');
          const expiryInfo = document.getElementById('expiry-info');
          
          if (maskingStatus) {
            if (data.is_existing) {
              maskingStatus.textContent = 'Using existing masked number';
            } else {
              maskingStatus.textContent = 'New masked number generated';
            }
          }
          
          // Set expiry countdown
          updateExpiryCountdown();
          
          // Update button text
          if (callButtonText) callButtonText.textContent = 'Call Masked Number';
          if (quickCallText) quickCallText.textContent = 'Call Masked Number';
          
          // Update href to use masked number
          if (callButton) callButton.onclick = () => window.location.href = `tel:${data.masked_number}`;
          if (quickCallButton) quickCallButton.onclick = () => window.location.href = `tel:${data.masked_number}`;
          
          // Show success message
          showNotification('Masked number generated successfully!', 'success');
          
        } else if (data.upgrade_required) {
          const planName = data.plan_name || 'Free Plan';
          showNotification(`Number masking is not available for your ${planName}. Please upgrade to a premium plan to use this feature.`, 'warning');
          // Fallback to direct call
          setTimeout(() => {
            window.location.href = `tel:{{ contact_info.phone }}`;
          }, 2000);
        } else if (data.vehicle_masking_disabled) {
          showNotification('Number masking is not enabled for this vehicle.', 'warning');
          // Fallback to direct call
          setTimeout(() => {
            window.location.href = `tel:{{ contact_info.phone }}`;
          }, 2000);
        } else if (data.limit_reached) {
          showNotification(`You have reached the maximum number of concurrent masking sessions (${data.max_sessions}) for your ${data.plan_name}. Please wait for existing sessions to expire or upgrade your plan.`, 'warning');
          // Fallback to direct call
          setTimeout(() => {
            window.location.href = `tel:{{ contact_info.phone }}`;
          }, 2000);
        } else {
          showNotification(data.error || 'Failed to get masked number', 'error');
          // Fallback to direct call
          setTimeout(() => {
            window.location.href = `tel:{{ contact_info.phone }}`;
          }, 2000);
        }
        
      } catch (error) {
        console.error('Error getting masked number:', error);
        showNotification('Error getting masked number. Using direct call.', 'error');
        // Fallback to direct call
        window.location.href = `tel:{{ contact_info.phone }}`;
      } finally {
        // Re-enable buttons
        if (callButton) callButton.disabled = false;
        if (quickCallButton) quickCallButton.disabled = false;
      }
    }
    
    async function checkExistingMaskingSession() {
      // This could be enhanced to check for existing sessions
      // For now, we'll start fresh each time
    }
    
    function updateExpiryCountdown() {
      if (!maskingExpiryTime) return;
      
      const expiryInfo = document.getElementById('expiry-info');
      
      function updateCountdown() {
        const now = new Date();
        const timeLeft = maskingExpiryTime - now;
        
        if (timeLeft <= 0) {
          if (expiryInfo) expiryInfo.textContent = 'Session expired';
          // Reset to original number
          resetToOriginalNumber();
          return;
        }
        
        const minutes = Math.floor(timeLeft / 60000);
        const seconds = Math.floor((timeLeft % 60000) / 1000);
        
        if (expiryInfo) expiryInfo.textContent = `Expires in ${minutes}:${seconds.toString().padStart(2, '0')}`;
      }
      
      updateCountdown();
      maskingTimer = setInterval(updateCountdown, 1000);
    }
    
    function resetToOriginalNumber() {
      if (maskingTimer) {
        clearInterval(maskingTimer);
        maskingTimer = null;
      }
      
      // Reset UI
      const phoneDisplay = document.getElementById('phone-display');
      const maskingInfo = document.getElementById('masking-info');
      const callButtonText = document.getElementById('call-button-text');
      const quickCallText = document.getElementById('quick-call-text');
      const callButton = document.getElementById('call-button');
      const quickCallButton = document.getElementById('quick-call-button');
      
      if (phoneDisplay) phoneDisplay.textContent = 'Click to reveal number';
      if (maskingInfo) maskingInfo.classList.remove('hidden');
      if (callButtonText) callButtonText.textContent = 'Call Now';
      if (quickCallText) quickCallText.textContent = 'Call Owner';
      
      // Reset onclick handlers
      if (callButton) callButton.onclick = handleCallClick;
      if (quickCallButton) quickCallButton.onclick = handleCallClick;
      
      currentMaskedNumber = null;
      currentSessionId = null;
      maskingExpiryTime = null;
    }
    
    function showNotification(message, type = 'info') {
      // Create notification element
      const notification = document.createElement('div');
      const colors = {
        success: 'bg-green-500',
        error: 'bg-red-500',
        warning: 'bg-yellow-500',
        info: 'bg-blue-500'
      };
      notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 text-white font-medium ${colors[type] || colors.info}`;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      // Remove after 3 seconds
      setTimeout(() => {
        notification.style.transition = 'opacity 0.3s';
        notification.style.opacity = '0';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }
    
    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }
  </script>
</body>
</html>

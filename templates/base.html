<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}ParkPing{% endblock %}</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .sidebar-gradient { background: linear-gradient(180deg, #667eea 0%, #764ba2 100%); }
    .card-shadow { box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075); }
    .hover-lift { transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; }
    .hover-lift:hover { transform: translateY(-2px); box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15); }
    
    /* Toast Notifications */
    .toast {
      transform: translateX(100%);
      transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
      opacity: 0;
    }
    .toast.show {
      transform: translateX(0);
      opacity: 1;
    }
    .toast.hide {
      transform: translateX(100%);
      opacity: 0;
    }
  </style>
  {% block extra_css %}{% endblock %}
</head>
<body class="h-full bg-gray-50">
  <!-- Sidebar -->
  <div class="fixed inset-y-0 left-0 z-50 w-64 bg-green-600 transform transition-transform duration-300 ease-in-out" id="sidebar">
    <!-- Sidebar Header -->
    <div class="flex items-center justify-between h-16 px-6">
      <div class="flex items-center space-x-3">
        <div class="w-8 h-8 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
          <i data-lucide="car" class="text-white w-4 h-4"></i>
        </div>
        <span class="text-xl font-bold text-white">PARKPING</span>
      </div>
      <button id="sidebar-toggle" class="lg:hidden p-2 rounded-md text-white hover:bg-white hover:bg-opacity-20">
        <i data-lucide="menu" class="w-5 h-5"></i>
      </button>
    </div>

    <!-- Sidebar Navigation -->
    <nav class="mt-6 px-3">
      <div class="space-y-1">
        <!-- Dashboard -->
        <a href="{% url 'accounts:dashboard' %}" class="flex items-center px-3 py-2 text-sm font-medium rounded-lg {% if request.resolver_match.url_name == 'dashboard' %}bg-white bg-opacity-20 text-white{% else %}text-white text-opacity-80 hover:bg-white hover:bg-opacity-10{% endif %} transition-colors duration-200">
          <i data-lucide="layout-dashboard" class="w-5 h-5 mr-3"></i>
          Dashboard
        </a>

        <!-- My Vehicles -->
        <a href="{% url 'parking:vehicle_list' %}" class="flex items-center px-3 py-2 text-sm font-medium {% if request.resolver_match.url_name == 'vehicle_list' %}bg-white bg-opacity-20 text-white{% else %}text-white text-opacity-80 hover:bg-white hover:bg-opacity-10{% endif %} rounded-lg transition-colors duration-200">
          <i data-lucide="car" class="w-5 h-5 mr-3"></i>
          My Vehicles
        </a>

        <!-- QR Codes -->
        <a href="{% url 'parking:qr_codes' %}" class="flex items-center px-3 py-2 text-sm font-medium {% if request.resolver_match.url_name == 'qr_codes' %}bg-white bg-opacity-20 text-white{% else %}text-white text-opacity-80 hover:bg-white hover:bg-opacity-10{% endif %} rounded-lg transition-colors duration-200">
          <i data-lucide="qr-code" class="w-5 h-5 mr-3"></i>
          QR Codes
        </a>

      </div>

      <!-- Account Section -->
      <div class="mt-8">
        <p class="px-3 text-xs font-semibold text-white text-opacity-60 uppercase tracking-wider mb-3">Account</p>
        <div class="space-y-1">
          <a href="{% url 'accounts:profile' %}" class="flex items-center px-3 py-2 text-sm font-medium text-white text-opacity-80 rounded-lg hover:bg-white hover:bg-opacity-10 transition-colors duration-200">
            <i data-lucide="user" class="w-5 h-5 mr-3"></i>
            Profile
          </a>
          <a href="{% url 'accounts:phone_numbers' %}" class="flex items-center px-3 py-2 text-sm font-medium text-white text-opacity-80 rounded-lg hover:bg-white hover:bg-opacity-10 transition-colors duration-200">
            <i data-lucide="phone" class="w-5 h-5 mr-3"></i>
            Phone Numbers
          </a>
          <form method="post" action="{% url 'accounts:logout' %}" class="inline">
            {% csrf_token %}
            <button type="submit" class="flex items-center px-3 py-2 text-sm font-medium text-white text-opacity-80 rounded-lg hover:bg-white hover:bg-opacity-10 transition-colors duration-200 w-full text-left">
              <i data-lucide="log-out" class="w-5 h-5 mr-3"></i>
              Logout
            </button>
          </form>
        </div>
      </div>
    </nav>
  </div>

  <!-- Toast Notifications Container -->
  <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>

  <!-- Main Content -->
  <div class="lg:pl-64">
    <!-- Page Content -->
    <main class="py-6">
      <div class="mx-auto px-4 sm:px-6 lg:px-8">
        {% block content %}{% endblock %}
      </div>
    </main>
  </div>

  <!-- Mobile Sidebar Overlay -->
  <div id="sidebar-overlay" class="fixed inset-0 z-40 bg-gray-600 bg-opacity-75 hidden lg:hidden"></div>

  <script>
    // Toast notification system
    function showToast(message, type = 'info', duration = 5000) {
      const toastContainer = document.getElementById('toast-container');
      
      // Create toast element
      const toast = document.createElement('div');
      toast.className = `toast max-w-lg w-full bg-white shadow-lg rounded-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden`;
      
      // Set toast colors based on type
      let iconColor = 'text-blue-500';
      let borderColor = 'border-l-blue-500';
      let icon = 'info';
      
      switch(type) {
        case 'success':
          iconColor = 'text-green-500';
          borderColor = 'border-l-green-500';
          icon = 'check-circle';
          break;
        case 'error':
          iconColor = 'text-red-500';
          borderColor = 'border-l-red-500';
          icon = 'x-circle';
          break;
        case 'warning':
          iconColor = 'text-yellow-500';
          borderColor = 'border-l-yellow-500';
          icon = 'alert-triangle';
          break;
        default:
          iconColor = 'text-blue-500';
          borderColor = 'border-l-blue-500';
          icon = 'info';
      }
      
      toast.innerHTML = `
        <div class="flex items-start p-4 border-l-4 ${borderColor}">
          <div class="flex-shrink-0">
            <i data-lucide="${icon}" class="h-5 w-5 ${iconColor}"></i>
          </div>
          <div class="ml-3 flex-1 min-w-0">
            <p class="text-sm font-medium text-gray-900 leading-relaxed">${message}</p>
          </div>
          <div class="ml-4 flex-shrink-0 flex">
            <button class="bg-white rounded-md inline-flex text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" onclick="hideToast(this.closest('.toast'))">
              <span class="sr-only">Close</span>
              <i data-lucide="x" class="h-5 w-5"></i>
            </button>
          </div>
        </div>
      `;
      
      // Add to container
      toastContainer.appendChild(toast);
      
      // Initialize Lucide icons for the new toast
      lucide.createIcons();
      
      // Show toast
      setTimeout(() => {
        toast.classList.add('show');
      }, 100);
      
      // Auto-hide after duration
      if (duration > 0) {
        setTimeout(() => {
          hideToast(toast);
        }, duration);
      }
      
      return toast;
    }
    
    function hideToast(toast) {
      toast.classList.add('hide');
      setTimeout(() => {
        if (toast.parentNode) {
          toast.parentNode.removeChild(toast);
        }
      }, 300);
    }

    // Sidebar toggle functionality
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize Lucide icons
      lucide.createIcons();
      
      const sidebar = document.getElementById('sidebar');
      const sidebarToggle = document.getElementById('sidebar-toggle');
      const sidebarOverlay = document.getElementById('sidebar-overlay');

      function toggleSidebar() {
        sidebar.classList.toggle('-translate-x-full');
        sidebarOverlay.classList.toggle('hidden');
      }

      sidebarToggle.addEventListener('click', toggleSidebar);
      sidebarOverlay.addEventListener('click', toggleSidebar);
      
      // Display Django messages as toasts
      {% if messages %}
        {% for message in messages %}
          showToast('{{ message|escapejs }}', '{{ message.tags }}');
        {% endfor %}
      {% endif %}
    });
  </script>

  {% block extra_js %}{% endblock %}
  
  <!-- Interactive Walkthrough -->
  {% include 'includes/walkthrough.html' %}
</body>
</html>
